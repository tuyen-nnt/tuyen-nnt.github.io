I"ä<h1 id="tÃ¬m-hiá»ƒu-vá»-etl">TÃ¬m hiá»ƒu vá» ETL</h1>

<h2 id="i-extract-data">I. EXTRACT DATA</h2>

<h3 id="1-cÃ¡c-cÃ¡ch-Ä‘á»ƒ-trÃ­ch-xuáº¥t-dá»¯-liá»‡u">1. CÃ¡c cÃ¡ch Ä‘á»ƒ trÃ­ch xuáº¥t dá»¯ liá»‡u</h3>
<p>CÃ³ 3 cÃ¡ch:</p>

<p><img src="img/extract.png" alt="" /></p>

<ul>
  <li>
    <p>TrÃ­ch xuáº¥t tá»« file text, nhÆ° file .txt or .csv
Text file cÃ³ 3 loáº¡i lÃ  : 
	* Text thuáº§n
	* Flat file (lÃ  file cÃ³ .tsv hoáº·c .csv cÃ¡ch nhau bá»Ÿi dáº¥u â€œ,â€ hoáº·c â€œtabâ€ giá»¯a cÃ¡c giÃ¡ trá»‹). Nhá»¯ng file nÃ y cÃ³ dÃ²ng thá»ƒ hiá»‡n cÃ¡c record vÃ  cá»™t thá»ƒ hiá»‡n attribute cá»§a record.
	*File JSON: bÃ¡n cáº¥u trÃºc, cÃ³ 4 kiá»ƒu dá»¯ liá»‡u atomic lÃ  number, string, boolean vÃ  null vÃ  2 kiá»ƒu dá»¯ liá»‡u dáº¡ng composite lÃ  array vÃ  object.
	JSON cÃ³ package há»— trá»£ lÃ  â€œjsonâ€ Ä‘á»ƒ import data
	<img src="img/load-json.png" alt="" /></p>
  </li>
  <li>
    <p>TrÃ­ch xuáº¥t tá»« web hoáº·c APIs cá»§a web services, nhÆ° lÃ  Hacker News API
<img src="img/web-extract.png" alt="" /></p>
    <ul>
      <li>ThÃ´ng qua web:</li>
    </ul>

    <p><img src="img/data-web.png" alt="" /></p>
  </li>
</ul>

<p>VÃ­ dá»¥: báº¡n tÃ¬m kiáº¿m thÃ´ng tin trÃªn google.com thÃ¬ trÃ¬nh duyá»‡t cá»§a báº¡n sáº½ gá»­i request cá»§a báº¡n Ä‘áº¿n server cá»§a google vÃ  google sáº½ tráº£ vá» dá»¯ liá»‡u mÃ  báº¡n Ä‘ang tÃ¬m kiáº¿m.</p>

<pre><code>* ThÃ´ng qua API cá»§a web:
</code></pre>

<p>KhÃ´ng pháº£i lÃºc nÃ o cÃ¡c trang web cÅ©ng tráº£ vá» káº¿t quáº£ mÃ  ngÆ°á»i thÆ°á»ng cÃ³ thá»ƒ Ä‘á»c ngay, mÃ  cÃ¡c trang web Ä‘Ã³ sáº½ tráº£ vá» Ä‘á»‹nh dáº¡ng JSON thÃ´ng qua API mÃ  chÃºng ta request.</p>

<p>Ta xem vÃ­ dá»¥ request API tá»« trang Hackernews:
<img src="img/api-request.png" alt="" />
Ta import package â€œrequestâ€ rá»“i dÃ¹ng method .get() Ä‘á»ƒ chÃ¨n vÃ o link web cáº§n láº¥y file JSON. 
Sau Ä‘Ã³ ta dÃ¹ng method .json() Ä‘á»ƒ phÃ¢n tÃ­ch file JSON tá»« káº¿t quáº£ Ä‘Ã£ láº¥y Ä‘Æ°á»£c vÃ  chuyá»ƒn hÃ³a nÃ³ thÃ nh Python object.</p>

<ul>
  <li>TrÃ­ch xuáº¥t tá»« má»™t database trÃªn web services 
Háº§u háº¿t cÃ¡c á»©ng dá»¥ng web Ä‘á»u cÃ³ database Ä‘á»ƒ backup vÃ  Ä‘á»ƒ khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng khi táº¯t server, v.v. Cáº§n phÃ¢n biá»‡t 2 loáº¡i database chÃ­nh trong trÆ°á»ng há»£p nÃ y:
    <ul>
      <li><em>Application database</em> : dÃ¹ng cho trÆ°á»ng há»£p cÃ³ nhiá»u giao dá»‹ch Ä‘Æ°á»£c cáº­p nháº­t, loáº¡i nÃ y cÃ²n cÃ³ tÃªn gá»i lÃ  <em>OLTP</em> (online transaction processing)</li>
      <li><em>Analytical database</em>: Ä‘Æ°á»£c xÃ¢y dá»±ng cho viá»‡c phÃ¢n tÃ­ch dá»¯ liá»‡u cÃ²n gá»i lÃ  <em>OLAP</em> (online analytical processing)</li>
    </ul>
  </li>
</ul>

<h3 id="2-trÃ­ch-xuáº¥t-dá»¯-liá»‡u-tá»«-database-nhÆ°-tháº¿-nÃ o">2. TrÃ­ch xuáº¥t dá»¯ liá»‡u tá»« database nhÆ° tháº¿ nÃ o?</h3>

<ul>
  <li>DÃ¹ng URI/chuá»—i connection, cÃº phÃ¡p nhÆ° sau:
    <pre><code>[database_type]://[user[:password]@][host][:port]
</code></pre>
  </li>
  <li>Trong Python, ta dÃ¹ng connection URI thÃ´ng qua package <code>sqlalchemy</code> Ä‘á»ƒ táº¡o <em>database engine</em> :</li>
</ul>

<p><img src="img/create-engine.png" alt="" /></p>

<p>Tá»« engine Ä‘Ã£ Ä‘Æ°á»£c táº¡o ra, ta cÃ³ thá»ƒ dÃ¹ng nÃ³ Ä‘á»ƒ Ä‘áº·t vÃ o 1 sá»‘ package há»— trá»£ nÃ³ tÆ°Æ¡ng tÃ¡c vá»›i database, Ä‘áº·c biá»‡t lÃ  package <code>pandas</code>.</p>

<ul>
  <li>import requests
```</li>
</ul>

<h1 id="láº¥y-dá»¯-liá»‡u-tá»«-bÃ i-viáº¿t-cá»§a-hackernews-vá»-f12-inspect-Ä‘á»ƒ-láº¥y-url-cá»§a-nÃ³">Láº¥y dá»¯ liá»‡u tá»« bÃ i viáº¿t cá»§a Hackernews vá», F12 inspect Ä‘á»ƒ láº¥y URL cá»§a nÃ³</h1>
<p>resp = requests.get(â€œhttps://hacker-news.firebaseio.com/v0/item/16222426.jsonâ€)</p>

<h1 id="in-dá»¯-liá»‡u-vá»«a-parse-thÃ nh-file-json-ra-mÃ n-hÃ¬nh">in dá»¯ liá»‡u vá»«a parse thÃ nh file json ra mÃ n hÃ¬nh</h1>
<p>print(resp.json())</p>

<h1 id="parse-dá»¯-liá»‡u-ra-rá»“i-gÃ¡n-value-cá»§a-key-score-vÃ o-biáº¿n-post_score-sau-Ä‘Ã³-in-cÃ¡i-biáº¿n-ra">parse dá»¯ liá»‡u ra rá»“i gÃ¡n value cá»§a key â€œscoreâ€ vÃ o biáº¿n post_score, sau Ä‘Ã³ in cÃ¡i biáº¿n ra</h1>
<p>post_score = resp.json()[â€œscoreâ€]
print(post_score)</p>
<pre><code>

* Má»™t sá»‘ vÃ­ dá»¥ má»Ÿ rá»™ng hÆ¡n (xem pháº§n 3 Ä‘á»ƒ hiá»ƒu hÆ¡n):

Äá»c dá»¯ liá»‡u tá»« database cá»§a postgreSQL, hÃ m extract dÃ¹ng SQL query cÃ³ nhiá»‡m vá»¥ chuyá»ƒn tá»« dá»¯ liá»‡u báº£ng thÃ nh kiá»ƒu object mÃ  pandas dÃ¹ng (lÃ  dataframe)

</code></pre>
<h1 id="function-to-extract-table-to-a-pandas-dataframe">Function to extract table to a pandas DataFrame</h1>
<p>def extract_table_to_pandas(tablename, db_engine):
    query = â€œSELECT * FROM {}â€.format(tablename)
    return pd.read_sql(query, db_engine)</p>

<h1 id="connect-to-the-database-using-the-connection-uri-sá»­-dá»¥ng-package-sqlalchemy">Connect to the database using the connection URI, sá»­ dá»¥ng package sqlalchemy</h1>
<p>connection_uri = â€œpostgresql://repl:password@localhost:5432/pagilaâ€ 
db_engine = sqlalchemy.create_engine(connection_uri)</p>

<h1 id="extract-the-film-table-into-a-pandas-dataframe-lÆ°u-Ã½-nhá»›-Ä‘á»ƒ-tÃªn-báº£ng-dáº¡ng-chuá»—i">Extract the film table into a pandas DataFrame, lÆ°u Ã½ nhá»› Ä‘á»ƒ tÃªn báº£ng dáº¡ng chuá»—i</h1>
<p>extract_table_to_pandas(â€œfilmâ€, db_engine)</p>

<h1 id="extract-the-customer-table-into-a-pandas-dataframe">Extract the customer table into a pandas DataFrame</h1>
<p>extract_table_to_pandas(â€œcustomerâ€, db_engine)
```</p>

<h2 id="2-transform-data">2. TRANSFORM DATA</h2>
<h3 id="1-má»™t-sá»‘-phÆ°Æ¡ng-thá»©c-chuyá»ƒn-Ä‘á»•i-dá»¯-liá»‡u">1. Má»™t sá»‘ phÆ°Æ¡ng thá»©c chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u</h3>
<p>CÃ³ thá»ƒ thá»±c hiá»‡n 1 hoáº·c nhiá»u cÃ¡c hÃ¬nh thá»©c trong giai Ä‘oáº¡n chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u Ä‘Ã£ rÃºt trÃ­ch:</p>

<ul>
  <li>Select 1 hay nhiá»u cá»™t</li>
  <li>PhiÃªn dá»‹ch dá»¯ liá»‡u thÃ nh code. VÃ­ dá»¥ nhÆ° New York sáº½ biáº¿n thÃ nh NY</li>
  <li>Kiá»ƒm tra dá»¯ liá»‡u cÃ³ Ä‘Ãºng khÃ´ng, náº¿u dá»¯ liá»‡u khÃ´ng Ä‘Ãºng vá»›i kiá»ƒu dá»¯ liá»‡u hoáº·c dá»¯ liá»‡u muá»‘n nháº­n tá»« cá»™t, ta cÃ³ thá»ƒ bá» record Ä‘Ã³ Ä‘i. VÃ­ dá»¥ nhÆ° cá»™t ngÃ y nhÆ°ng láº¡i chá»©a giÃ¡ trá»‹ khÃ¡c ngÃ y.</li>
  <li>TÃ¡ch dá»¯ liá»‡u cá»§a 1 cá»™t thÃ nh nhiá»u cá»™t</li>
  <li>Join dá»¯ liá»‡u tá»« cÃ¡c nguá»“n, cÃ¡c báº£ng khÃ¡c nhau.</li>
</ul>

<h3 id="2-má»™t-sá»‘-vÃ­-dá»¥">2. Má»™t sá»‘ vÃ­ dá»¥</h3>

<p>Báº¡n cÃ³ thá»ƒ dÃ¹ng package <code>pandas</code> Ä‘á»ƒ chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u náº¿u lÆ°á»£ng dá»¯ liá»‡u nhá». Ta cÃ³ vÃ­ dá»¥ tÃ¡ch dá»¯ liá»‡u tá»« 1 cá»™t thÃ nh 2 cá»™t sá»­ dá»¥ng pandas:
<img src="img/split-pandas.png" alt="" /></p>

<p>Náº¿u dá»¯ liá»‡u lá»›n, thÃ´ng thÆ°á»ng ngÆ°á»i ta sáº½ dÃ¹ng <strong>PySpark</strong>. Ta cÃ³ vÃ­ dá»¥ chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u báº±ng cÃ¡ch join cÃ¡c báº£ng vá»›i nhau. 
NhÆ°ng trÆ°á»›c háº¿t chÃºng ta cáº§n Ä‘áº©y dá»¯ liá»‡u lÃªn Spark:</p>

<p><img src="img/extract-pyspark.png" alt="" /></p>

<p><code>jbdc:</code>Ä‘á»ƒ nháº¯n nhá»§ vá»›i Spark lÃ  pháº£i dÃ¹ng JBDC Ä‘á»ƒ káº¿t ná»‘i, sau Ä‘Ã³, ta input vÃ o tÃªn cá»§a báº£ng vÃ  cuá»‘i cÃ¹ng trong <code>properties</code> chÃºng ta Ä‘áº·t thÃ´ng tin káº¿t ná»‘i vÃ o.</p>

<p>DÆ°á»›i Ä‘Ã¢y lÃ  2 báº£ng cáº§n join vá»›i nhau thÃ´ng qua <code>customer_id</code> Ä‘á»ƒ tÃ­nh rating trung bÃ¬nh cá»§a má»—i customer dÃ nh cho cÃ¡c phim:</p>

<p><img src="img/rating-join.png" alt="" /></p>

<p>VÃ  lÃ m sao Ä‘á»ƒ dÃ¹ng PySpark join vÃ  tÃ­nh toÃ¡n dá»¯ liá»‡u? Xem áº£nh dÆ°á»›i nhÃ©:</p>

<p><img src="img/join-pyspark.png" alt="" /></p>

<p>MÃ¬nh sáº½ cho ra thÃªm cÃ¡c bÃ i viáº¿t tÃ¬m hiá»ƒu sÃ¢u hÆ¡n vá» PySpark trong thá»i gian tá»›i, cÃ¡c báº¡n hÃ£y cÃ¹ng chá» Ä‘á»£i nhÃ©!</p>

<h2 id="iii-load-data">III. LOAD DATA</h2>

:ET